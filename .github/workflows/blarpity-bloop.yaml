name: Just testin a thing

on:
  workflow_dispatch:

env:
  SLACK_TOKEN: ${{ secrets.SLACK_TOKEN }}
  CHANNEL: 'C040V2HQCQ0'
  BOT_ID: 'B03VB855JSY'

jobs:
  slack-wordle:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - run: |
          ANSWER=$(curl --silent "https://wordle.dallin.pro/?date=$(TZ=HST date +'%m/%d/%Y')")
          echo "ANSWER IS: $ANSWER"

          NUMBER=$(curl --silent --head "https://wordle.dallin.pro/?date=$(TZ=UTC date +'%m/%d/%Y')" | grep x-days-from | awk '{print $2}' | tr -d '\r')
          echo "NUMBER IS: $NUMBER"

          # MSG=$(curl --silent -H "Authorization: Bearer $SLACK_TOKEN" "https://slack.com/api/conversations.history?channel=$CHANNEL" | jq -c '[.messages[] | select(.bot_id == "$BOT_ID")][0]')

          # ANSWER_DATA='{"text":'$(echo $MSG | jq '.text' | sed "s/?????/$ANSWER/")',"channel":"'$CHANNEL'","ts":'$(echo $MSG | jq '.ts')'}'
          # curl --silent -X POST -H 'Content-type: application/json; charset=utf-8' -H "Authorization: Bearer $SLACK_TOKEN" --data $ANSWER_DATA "https://slack.com/api/chat.update"

          QUESTION_DATA='{"text":"Wordle '"$NUMBER"' - ?????","channel":"'$CHANNEL'"}'
          echo "QUESTION IS: $QUESTION_DATA"

          curl --silent -X POST -H 'Content-type: application/json; charset=utf-8' -H "Authorization: Bearer $SLACK_TOKEN" --data $QUESTION_DATA "https://slack.com/api/chat.postMessage"
          echo "IT IS DONE"
